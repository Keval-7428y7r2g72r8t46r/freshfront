import{g as D,r as ye}from"./index-DdTMf38Y.js";function me(){if(typeof navigator<"u"&&navigator.product==="ReactNative")return!0;if(typeof process<"u"){const e=process.type;return e==="renderer"||e==="worker"?!1:!!(process.versions&&process.versions.node)}return!1}const ge={toWeb(){throw new Error("Vercel Blob: Sorry, we cannot get a Readable stream in this environment. If you see this message please open an issue here: https://github.com/vercel/storage/ with details on your environment.")}};/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var M,W;function we(){return W||(W=1,M=function(t){return t!=null&&t.constructor!=null&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}),M}var ve=we();const Ee=D(ve);var $,Y;function _e(){if(Y)return $;Y=1;var e=ye();function t(r,s){function a(n,o){var i=s||{},l;"randomize"in i||(i.randomize=!0),l=e.operation(i);function d(p){o(p||new Error("Aborted"))}function b(p,c){if(p.bail){d(p);return}l.retry(p)?i.onRetry&&i.onRetry(p,c):o(l.mainError())}function y(p){var c;try{c=r(d,p)}catch(g){b(g,p);return}Promise.resolve(c).then(n).catch(function(_){b(_,p)})}l.attempt(y)}return new Promise(a)}return $=t,$}var Te=_e();const Re=D(Te),j=globalThis.fetch.bind(globalThis);var V,J;function Be(){if(J)return V;J=1;function e(t,r){if(typeof t!="function")throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof t}\`.`);let s,a=0;return function(...o){clearTimeout(s);const i=Date.now(),l=i-a,d=r-l;d<=0?(a=i,t.apply(this,o)):s=setTimeout(()=>{a=Date.now(),t.apply(this,o)},d)}}return V=e,V}var xe=Be();const ae=D(xe);var m={},Le=new Promise(e=>{try{const t=new Uint8Array([104,101,108,108,111]);new Blob([t]).text().then(s=>{e(s==="hello")}).catch(()=>{e(!1)})}catch{e(!1)}});async function se(e){if(e instanceof ReadableStream)return e;if(e instanceof Blob)return e.stream();if(ie(e))return ge.toWeb(e);let t;return e instanceof ArrayBuffer?t=new Uint8Array(e):Pe(e)?t=e:t=Ue(e),await Le?new Blob([t]).stream():new ReadableStream({start(r){r.enqueue(t),r.close()}})}function ie(e){return typeof e=="object"&&typeof e.pipe=="function"&&e.readable&&typeof e._read=="function"&&typeof e._readableState=="object"}function Ue(e){return new TextEncoder().encode(e)}function Pe(e){return Ee(e)}var Se=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i,Ae={b:1,kb:1024,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)};function v(e){if(typeof e=="number"&&!isNaN(e))return e;if(typeof e!="string")return null;const t=Se.exec(e);let r,s="b";if(!t)r=parseInt(e,10);else{const[,a,,,n]=t;if(!a)return null;r=parseFloat(a),n&&(s=n.toLowerCase())}return isNaN(r)?null:Math.floor(Ae[s]*r)}function ke(e){if(e!=null&&e.token)return e.token;if(m.BLOB_READ_WRITE_TOKEN)return m.BLOB_READ_WRITE_TOKEN;throw new f("No token found. Either configure the `BLOB_READ_WRITE_TOKEN` environment variable, or pass a `token` option to your calls.")}var f=class extends Error{constructor(e){super(`Vercel Blob: ${e}`)}};function Ne(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}var Ie=["//"],le=(()=>{if(me())return!0;if(F().startsWith("http://localhost"))return!1;let t=!1;const r=new Request(F(),{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r})();function F(e=""){let t=null;try{t=m.VERCEL_BLOB_API_URL||m.NEXT_PUBLIC_VERCEL_BLOB_API_URL}catch{}return`${t||"https://blob.vercel-storage.com"}${e}`}var K=typeof TextEncoder=="function"?new TextEncoder:null;function ce(e){return e?typeof e=="string"?K?K.encode(e).byteLength:new Blob([e]).size:"byteLength"in e&&typeof e.byteLength=="number"?e.byteLength:"size"in e&&typeof e.size=="number"?e.size:0:0}var Ce=(e,t)=>{let r=new Uint8Array(0);return new TransformStream({transform(s,a){queueMicrotask(()=>{const n=new Uint8Array(r.length+s.byteLength);for(n.set(r),n.set(new Uint8Array(s),r.length),r=n;r.length>=e;){const o=r.slice(0,e);a.enqueue(o),t==null||t(o.byteLength),r=r.slice(e)}})},flush(s){queueMicrotask(()=>{r.length>0&&(s.enqueue(r),t==null||t(r.byteLength))})}})};function ue(e){return globalThis.ReadableStream&&e instanceof ReadableStream}function Oe(e){return!!(ue(e)||ie(e))}var qe=Object.prototype.toString,Me=e=>qe.call(e)==="[object Error]",$e=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function Ve(e){return e&&Me(e)&&e.name==="TypeError"&&typeof e.message=="string"?e.message==="Load failed"?e.stack===void 0:$e.has(e.message):!1}var de=!1,Z,Q;try{((Z=m.DEBUG)!=null&&Z.includes("blob")||(Q=m.NEXT_PUBLIC_DEBUG)!=null&&Q.includes("blob"))&&(de=!0)}catch{}function w(e,...t){de&&console.debug(`vercel-blob: ${e}`,...t)}var fe=typeof j=="function",He=fe&&le,Fe=64*1024,ee=async({input:e,init:t,onUploadProgress:r})=>{w("using fetch");let s;if(t.body)if(r){const n=await se(t.body);let o=0;const i=Ce(Fe,l=>{o+=l,r(o)});s=n.pipeThrough(i)}else s=t.body;const a=le&&s&&Oe(s)?"half":void 0;return j(e,{...t,...t.body?{body:s}:{},duplex:a})},te=typeof XMLHttpRequest<"u",re=async({input:e,init:t,onUploadProgress:r})=>{w("using xhr");let s=null;return t.body&&(ue(t.body)?s=await new Response(t.body).blob():s=t.body),new Promise((a,n)=>{const o=new XMLHttpRequest;if(o.open(t.method||"GET",e.toString(),!0),r&&o.upload.addEventListener("progress",i=>{i.lengthComputable&&r(i.loaded)}),o.onload=()=>{var i;if((i=t.signal)!=null&&i.aborted){n(new DOMException("The user aborted the request.","AbortError"));return}const l=new Headers;o.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(y=>{const p=y.split(": "),c=p.shift(),g=p.join(": ");c&&l.set(c.toLowerCase(),g)});const b=new Response(o.response,{status:o.status,statusText:o.statusText,headers:l});a(b)},o.onerror=()=>{n(new TypeError("Network request failed"))},o.ontimeout=()=>{n(new TypeError("Network request timed out"))},o.onabort=()=>{n(new DOMException("The user aborted a request.","AbortError"))},t.headers&&new Headers(t.headers).forEach((l,d)=>{o.setRequestHeader(d,l)}),t.signal&&(t.signal.addEventListener("abort",()=>{o.abort()}),t.signal.aborted)){o.abort();return}o.send(s)})},Xe=async({input:e,init:t,onUploadProgress:r})=>{if(r){if(He)return ee({input:e,init:t,onUploadProgress:r});if(te)return re({input:e,init:t,onUploadProgress:r})}if(fe)return ee({input:e,init:t});if(te)return re({input:e,init:t});throw new Error("No request implementation available")},ne,De=(ne=globalThis.DOMException)!=null?ne:(()=>{try{atob("~")}catch(e){return Object.getPrototypeOf(e).constructor}})(),oe=950,je=class extends f{constructor(){super("Access denied, please provide a valid token for this resource.")}},ze=class extends f{constructor(e){super(`Content type mismatch, ${e}.`)}},Ge=class extends f{constructor(e){super(`Pathname mismatch, ${e}. Check the pathname used in upload() or put() matches the one from the client token.`)}},We=class extends f{constructor(){super("Client token has expired.")}},Ye=class extends f{constructor(e){super(`File is too large, ${e}.`)}},Je=class extends f{constructor(){super("This store does not exist.")}},Ke=class extends f{constructor(){super("This store has been suspended.")}},pe=class extends f{constructor(){super("Unknown error, please visit https://vercel.com/help.")}},Ze=class extends f{constructor(){super("The requested blob does not exist")}},I=class extends f{constructor(){super("The blob service is currently not available. Please try again.")}},Qe=class extends f{constructor(e){super(`Too many requests please lower the number of concurrent requests ${e?` - try again in ${e} seconds`:""}.`),this.retryAfter=e??0}},et=class extends f{constructor(){super("The request was aborted.")}},tt=9;function rt(){let e=null;try{e=m.VERCEL_BLOB_API_VERSION_OVERRIDE||m.NEXT_PUBLIC_VERCEL_BLOB_API_VERSION_OVERRIDE}catch{}return`${e??tt}`}function nt(){try{const e=m.VERCEL_BLOB_RETRIES||"10";return parseInt(e,10)}catch{return 10}}function ot(e){const t=e.headers.get("retry-after");return new Qe(t?parseInt(t,10):void 0)}async function at(e){var t,r,s;let a,n;try{const i=await e.json();a=(r=(t=i.error)==null?void 0:t.code)!=null?r:"unknown_error",n=(s=i.error)==null?void 0:s.message}catch{a="unknown_error"}n!=null&&n.includes("contentType")&&n.includes("is not allowed")&&(a="content_type_not_allowed"),n!=null&&n.includes('"pathname"')&&n.includes("does not match the token payload")&&(a="client_token_pathname_mismatch"),n==="Token expired"&&(a="client_token_expired"),n!=null&&n.includes("the file length cannot be greater than")&&(a="file_too_large");let o;switch(a){case"store_suspended":o=new Ke;break;case"forbidden":o=new je;break;case"content_type_not_allowed":o=new ze(n);break;case"client_token_pathname_mismatch":o=new Ge(n);break;case"client_token_expired":o=new We;break;case"file_too_large":o=new Ye(n);break;case"not_found":o=new Ze;break;case"store_not_found":o=new Je;break;case"bad_request":o=new f(n??"Bad request");break;case"service_unavailable":o=new I;break;case"rate_limited":o=ot(e);break;case"unknown_error":case"not_allowed":default:o=new pe;break}return{code:a,error:o}}async function C(e,t,r){const s=rt(),a=ke(r),n=st(),[,,,o=""]=a.split("_"),i=`${o}:${Date.now()}:${Math.random().toString(16).slice(2)}`;let l=0,d=0,b=0;const y=(r==null?void 0:r.onUploadProgress)||it();t.body&&y&&(d=ce(t.body)),r!=null&&r.onUploadProgress&&r.onUploadProgress({loaded:0,total:d,percentage:0});const p=await Re(async c=>{let g;try{g=await Xe({input:F(e),init:{...t,headers:{"x-api-blob-request-id":i,"x-api-blob-request-attempt":String(l),"x-api-version":s,...y?{"x-content-length":String(d)}:{},authorization:`Bearer ${a}`,...n,...t.headers}},onUploadProgress:r!=null&&r.onUploadProgress?h=>{var L;const R=d!==0?d:h;b=h;const B=d>0?Number((h/R*100).toFixed(2)):0;B===100&&d>0||(L=r.onUploadProgress)==null||L.call(r,{loaded:h,total:R,percentage:B})}:void 0})}catch(h){if(h instanceof De&&h.name==="AbortError"){c(new et);return}if(Ve(h))throw h;if(h instanceof TypeError){c(h);return}throw h}if(g.ok)return g;const{code:_,error:T}=await at(g);if(_==="unknown_error"||_==="service_unavailable"||_==="internal_server_error")throw T;c(T)},{retries:nt(),onRetry:c=>{c instanceof Error&&w(`retrying API request to ${e}`,c.message),l=l+1}});if(!p)throw new pe;return r!=null&&r.onUploadProgress&&r.onUploadProgress({loaded:b,total:b,percentage:100}),await p.json()}function st(){const e={};try{"VERCEL_BLOB_PROXY_THROUGH_ALTERNATIVE_API"in m&&m.VERCEL_BLOB_PROXY_THROUGH_ALTERNATIVE_API!==void 0?e["x-proxy-through-alternative-api"]=m.VERCEL_BLOB_PROXY_THROUGH_ALTERNATIVE_API:"NEXT_PUBLIC_VERCEL_BLOB_PROXY_THROUGH_ALTERNATIVE_API"in m&&m.NEXT_PUBLIC_VERCEL_BLOB_PROXY_THROUGH_ALTERNATIVE_API!==void 0&&(e["x-proxy-through-alternative-api"]=m.NEXT_PUBLIC_VERCEL_BLOB_PROXY_THROUGH_ALTERNATIVE_API)}catch{}return e}function it(){try{return m.VERCEL_BLOB_USE_X_CONTENT_LENGTH==="1"}catch{return!1}}var H={cacheControlMaxAge:"x-cache-control-max-age",addRandomSuffix:"x-add-random-suffix",contentType:"x-content-type"};function lt(e,t){const r={};return e.includes("contentType")&&t.contentType&&(r[H.contentType]=t.contentType),e.includes("addRandomSuffix")&&t.addRandomSuffix!==void 0&&(r[H.addRandomSuffix]=t.addRandomSuffix?"1":"0"),e.includes("cacheControlMaxAge")&&t.cacheControlMaxAge!==void 0&&(r[H.cacheControlMaxAge]=t.cacheControlMaxAge.toString()),r}async function ct({pathname:e,options:t,extraChecks:r,getToken:s}){if(!e)throw new f("pathname is required");if(e.length>oe)throw new f(`pathname is too long, maximum length is ${oe}`);for(const a of Ie)if(e.includes(a))throw new f(`pathname cannot contain "${a}", please encode it if needed`);if(!t)throw new f("missing options, see usage");if(t.access!=="public")throw new f('access must be "public"');return r&&r(t),s&&(t.token=await s(e,t)),t}async function ut({uploadId:e,key:t,pathname:r,parts:s,headers:a,options:n}){const o=new URLSearchParams({pathname:r});try{const i=await C(`/mpu?${o.toString()}`,{method:"POST",headers:{...a,"content-type":"application/json","x-mpu-action":"complete","x-mpu-upload-id":e,"x-mpu-key":encodeURIComponent(t)},body:JSON.stringify(s),signal:n.abortSignal},n);return w("mpu: complete",i),i}catch(i){throw i instanceof TypeError&&(i.message==="Failed to fetch"||i.message==="fetch failed")?new I:i}}async function dt(e,t,r){w("mpu: create","pathname:",e);const s=new URLSearchParams({pathname:e});try{const a=await C(`/mpu?${s.toString()}`,{method:"POST",headers:{...t,"x-mpu-action":"create"},signal:r.abortSignal},r);return w("mpu: create",a),a}catch(a){throw a instanceof TypeError&&(a.message==="Failed to fetch"||a.message==="fetch failed")?new I:a}}async function ft({uploadId:e,key:t,pathname:r,headers:s,options:a,internalAbortController:n=new AbortController,part:o}){var i,l,d;const b=new URLSearchParams({pathname:r}),y=C(`/mpu?${b.toString()}`,{signal:n.signal,method:"POST",headers:{...s,"x-mpu-action":"upload","x-mpu-key":encodeURIComponent(t),"x-mpu-upload-id":e,"x-mpu-part-number":o.partNumber.toString()},body:o.blob},a);function p(){n.abort()}(i=a.abortSignal)!=null&&i.aborted?p():(l=a.abortSignal)==null||l.addEventListener("abort",p);const c=await y;return(d=a.abortSignal)==null||d.removeEventListener("abort",p),c}var he=typeof window<"u"?6:8,X=8*1024*1024,P=he*X*2;function pt({uploadId:e,key:t,pathname:r,stream:s,headers:a,options:n,totalToLoad:o}){w("mpu: upload init","key:",t);const i=new AbortController;return new Promise((l,d)=>{const b=[],y=[],p=s.getReader();let c=0,g=!1,_=1,T=!1,h=0,L=!1,R=0,B=[],S=0,O;const z={};n.onUploadProgress&&(O=ae(()=>{var u;const E=Object.values(z).reduce((k,N)=>k+N,0),x=o||E,U=o>0?Number(((E/o||E)*100).toFixed(2)):0;(u=n.onUploadProgress)==null||u.call(n,{loaded:E,total:x,percentage:U})},150)),G().catch(A);async function G(){for(w("mpu: upload read start","activeUploads:",c,"currentBytesInMemory:",`${v(h)}/${v(P)}`,"bytesSent:",v(R)),g=!0;h<P&&!T;)try{const{value:u,done:E}=await p.read();if(E){L=!0,w("mpu: upload read consumed the whole stream"),B.length>0&&(b.push({partNumber:_++,blob:new Blob(B,{type:"application/octet-stream"})}),q()),g=!1;return}h+=u.byteLength;let x=0;for(;x<u.byteLength;){const U=X-S,k=Math.min(x+U,u.byteLength),N=u.slice(x,k);B.push(N),S+=N.byteLength,x=k,S===X&&(b.push({partNumber:_++,blob:new Blob(B,{type:"application/octet-stream"})}),B=[],S=0,q())}}catch(u){A(u)}w("mpu: upload read end","activeUploads:",c,"currentBytesInMemory:",`${v(h)}/${v(P)}`,"bytesSent:",v(R)),g=!1}async function be(u){c++,w("mpu: upload send part start","partNumber:",u.partNumber,"size:",u.blob.size,"activeUploads:",c,"currentBytesInMemory:",`${v(h)}/${v(P)}`,"bytesSent:",v(R));try{const E=n.onUploadProgress?U=>{z[u.partNumber]=U.loaded,O&&O()}:void 0,x=await ft({uploadId:e,key:t,pathname:r,headers:a,options:{...n,onUploadProgress:E},internalAbortController:i,part:u});if(w("mpu: upload send part end","partNumber:",u.partNumber,"activeUploads",c,"currentBytesInMemory:",`${v(h)}/${v(P)}`,"bytesSent:",v(R)),T)return;if(y.push({partNumber:u.partNumber,etag:x.etag}),h-=u.blob.size,c--,R+=u.blob.size,b.length>0&&q(),L){c===0&&(p.releaseLock(),l(y));return}g||G().catch(A)}catch(E){A(E)}}function q(){if(!T)for(w("send parts","activeUploads",c,"partsToUpload",b.length);c<he&&b.length>0;){const u=b.shift();u&&be(u)}}function A(u){T||(T=!0,i.abort(),p.releaseLock(),u instanceof TypeError&&(u.message==="Failed to fetch"||u.message==="fetch failed")?d(new I):d(u))}})}async function ht(e,t,r,s){w("mpu: init","pathname:",e,"headers:",r);const a={...s,onUploadProgress:void 0},n=await dt(e,r,a),o=ce(t),i=await se(t),l=await pt({uploadId:n.uploadId,key:n.key,pathname:e,stream:i,headers:r,options:s,totalToLoad:o});return await ut({uploadId:n.uploadId,key:n.key,pathname:e,parts:l,headers:r,options:a})}function bt({allowedOptions:e,getToken:t,extraChecks:r}){return async function(a,n,o){if(!n)throw new f("body is required");if(Ne(n))throw new f("Body must be a string, buffer or stream. You sent a plain JavaScript object, double check what you're trying to upload.");const i=await ct({pathname:a,options:o,extraChecks:r,getToken:t}),l=lt(e,i);if(i.multipart===!0)return ht(a,n,l,i);const d=i.onUploadProgress?ae(i.onUploadProgress,100):void 0,b=new URLSearchParams({pathname:a}),y=await C(`/?${b.toString()}`,{method:"PUT",body:n,headers:l,signal:i.abortSignal},{...i,onUploadProgress:d});return{url:y.url,downloadUrl:y.downloadUrl,pathname:y.pathname,contentType:y.contentType,contentDisposition:y.contentDisposition}}}/*!
 * bytes
 * Copyright(c) 2012-2014 TJ Holowaychuk
 * Copyright(c) 2015 Jed Watson
 * MIT Licensed
 */var Et=bt({allowedOptions:["contentType"],extraChecks(e){if(e.handleUploadUrl===void 0)throw new f("client/`upload` requires the 'handleUploadUrl' parameter");if(e.addRandomSuffix!==void 0||e.cacheControlMaxAge!==void 0)throw new f("client/`upload` doesn't allow addRandomSuffix and cacheControlMaxAge. Configure these options at the server side when generating client tokens.")},async getToken(e,t){var r,s;return mt({handleUploadUrl:t.handleUploadUrl,pathname:e,clientPayload:(r=t.clientPayload)!=null?r:null,multipart:(s=t.multipart)!=null?s:!1})}}),yt={generateClientToken:"blob.generate-client-token"};async function mt(e){const{handleUploadUrl:t,pathname:r}=e,s=wt(t)?t:gt(t),a={type:yt.generateClientToken,payload:{pathname:r,callbackUrl:s,clientPayload:e.clientPayload,multipart:e.multipart}},n=await j(s,{method:"POST",body:JSON.stringify(a),headers:{"content-type":"application/json"},signal:e.abortSignal});if(!n.ok)throw new f("Failed to  retrieve the client token");try{const{clientToken:o}=await n.json();return o}catch{throw new f("Failed to retrieve the client token")}}function gt(e){return new URL(e,location.href).href}function wt(e){try{return!!new URL(e)}catch{return!1}}export{Et as upload};
